[{"/Users/ngw/Documents/Sites/Pianopet/client/src/index.js":"1","/Users/ngw/Documents/Sites/Pianopet/client/src/App.js":"2","/Users/ngw/Documents/Sites/Pianopet/client/src/reportWebVitals.js":"3","/Users/ngw/Documents/Sites/Pianopet/client/src/components/Dashboard.js":"4","/Users/ngw/Documents/Sites/Pianopet/client/src/AppContext.js":"5","/Users/ngw/Documents/Sites/Pianopet/client/src/utils/index.js":"6","/Users/ngw/Documents/Sites/Pianopet/client/src/components/Guest.js":"7","/Users/ngw/Documents/Sites/Pianopet/client/src/components/Loading.js":"8","/Users/ngw/Documents/Sites/Pianopet/client/src/components/MiniMenu.js":"9","/Users/ngw/Documents/Sites/Pianopet/client/src/components/Modal.js":"10","/Users/ngw/Documents/Sites/Pianopet/client/src/components/Student.js":"11","/Users/ngw/Documents/Sites/Pianopet/client/src/components/Teacher.js":"12","/Users/ngw/Documents/Sites/Pianopet/client/src/components/Marketplace.js":"13","/Users/ngw/Documents/Sites/Pianopet/client/src/components/ViewStudent.js":"14","/Users/ngw/Documents/Sites/Pianopet/client/src/components/ContextMenu.js":"15","/Users/ngw/Documents/Sites/Pianopet/client/src/components/Dropdown.js":"16","/Users/ngw/Documents/Sites/Pianopet/client/src/components/Avatar.js":"17","/Users/ngw/Documents/Sites/Pianopet/client/src/components/Closet.js":"18","/Users/ngw/Documents/Sites/Pianopet/client/src/components/Button.js":"19","/Users/ngw/Documents/Sites/Pianopet/client/src/components/MyAccount.js":"20","/Users/ngw/Documents/Sites/Pianopet/client/src/components/PianopetBase.js":"21","/Users/ngw/Documents/Sites/Pianopet/client/src/utils/ntc.js":"22","/Users/ngw/Documents/Sites/Pianopet/client/src/components/Splat.js":"23"},{"size":500,"mtime":1607403407622,"results":"24","hashOfConfig":"25"},{"size":2611,"mtime":1614304106633,"results":"26","hashOfConfig":"25"},{"size":362,"mtime":1607403407623,"results":"27","hashOfConfig":"25"},{"size":1826,"mtime":1614160185854,"results":"28","hashOfConfig":"25"},{"size":97,"mtime":1607733049448,"results":"29","hashOfConfig":"30"},{"size":617,"mtime":1613104797140,"results":"31","hashOfConfig":"25"},{"size":8716,"mtime":1614306014271,"results":"32","hashOfConfig":"25"},{"size":410,"mtime":1613709289227,"results":"33","hashOfConfig":"25"},{"size":684,"mtime":1612233978520,"results":"34","hashOfConfig":"30"},{"size":965,"mtime":1612233987275,"results":"35","hashOfConfig":"25"},{"size":13195,"mtime":1614412559859,"results":"36","hashOfConfig":"25"},{"size":14957,"mtime":1614303254790,"results":"37","hashOfConfig":"25"},{"size":28195,"mtime":1614327458978,"results":"38","hashOfConfig":"25"},{"size":17432,"mtime":1614160220758,"results":"39","hashOfConfig":"25"},{"size":763,"mtime":1613722986777,"results":"40","hashOfConfig":"25"},{"size":4621,"mtime":1613791108724,"results":"41","hashOfConfig":"25"},{"size":1349,"mtime":1614325226622,"results":"42","hashOfConfig":"25"},{"size":3702,"mtime":1614412567332,"results":"43","hashOfConfig":"25"},{"size":1834,"mtime":1613715784896,"results":"44","hashOfConfig":"25"},{"size":6253,"mtime":1613975599081,"results":"45","hashOfConfig":"25"},{"size":1784,"mtime":1614323810625,"results":"46","hashOfConfig":"25"},{"size":44387,"mtime":1614317676027,"results":"47","hashOfConfig":"25"},{"size":2959,"mtime":1614319325962,"results":"48","hashOfConfig":"25"},{"filePath":"49","messages":"50","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"51"},"1e1hwtf",{"filePath":"52","messages":"53","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"51"},{"filePath":"54","messages":"55","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"51"},{"filePath":"56","messages":"57","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"51"},{"filePath":"58","messages":"59","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"60"},"sahw5t",{"filePath":"61","messages":"62","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"51"},{"filePath":"63","messages":"64","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"51"},{"filePath":"65","messages":"66","errorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"67","usedDeprecatedRules":"51"},{"filePath":"68","messages":"69","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"70"},{"filePath":"71","messages":"72","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"51"},{"filePath":"73","messages":"74","errorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"75","usedDeprecatedRules":"51"},{"filePath":"76","messages":"77","errorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"78","usedDeprecatedRules":"51"},{"filePath":"79","messages":"80","errorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"81","usedDeprecatedRules":"51"},{"filePath":"82","messages":"83","errorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"84","usedDeprecatedRules":"51"},{"filePath":"85","messages":"86","errorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"87","usedDeprecatedRules":"51"},{"filePath":"88","messages":"89","errorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"90","usedDeprecatedRules":"51"},{"filePath":"91","messages":"92","errorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"93","usedDeprecatedRules":"51"},{"filePath":"94","messages":"95","errorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"96","usedDeprecatedRules":"51"},{"filePath":"97","messages":"98","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"51"},{"filePath":"99","messages":"100","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"51"},{"filePath":"101","messages":"102","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"103"},{"filePath":"104","messages":"105","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"51"},{"filePath":"106","messages":"107","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"51"},"/Users/ngw/Documents/Sites/Pianopet/client/src/index.js",[],["108","109"],"/Users/ngw/Documents/Sites/Pianopet/client/src/App.js",[],"/Users/ngw/Documents/Sites/Pianopet/client/src/reportWebVitals.js",[],"/Users/ngw/Documents/Sites/Pianopet/client/src/components/Dashboard.js",[],"/Users/ngw/Documents/Sites/Pianopet/client/src/AppContext.js",[],["110","111"],"/Users/ngw/Documents/Sites/Pianopet/client/src/utils/index.js",[],"/Users/ngw/Documents/Sites/Pianopet/client/src/components/Guest.js",[],"/Users/ngw/Documents/Sites/Pianopet/client/src/components/Loading.js",["112"],"import { ReactComponent as LoadingIcon } from './Loading.svg';\n\nfunction Loading(props) {\n    const { width, height } = props;\n    const style = new Object();\n    if (width) style.width = width + 'px';\n    if (height) style.height = height + 'px';\n    return (\n        <div className={`Loading${height ? ' mini' : ''}`} style={style}>\n            <LoadingIcon />\n        </div>\n    )\n}\n\nexport default Loading;","/Users/ngw/Documents/Sites/Pianopet/client/src/components/MiniMenu.js",[],["113","114"],"/Users/ngw/Documents/Sites/Pianopet/client/src/components/Modal.js",[],"/Users/ngw/Documents/Sites/Pianopet/client/src/components/Student.js",["115","116","117"],"import { useState, useEffect, useRef } from 'react';\nimport { Dashboard, Header, Sidebar, Nav } from './Dashboard';\nimport Closet from './Closet';\nimport Avatar from './Avatar';\nimport Marketplace from './Marketplace';\nimport ContextMenu from './ContextMenu';\nimport { prettifyDate } from '../utils';\nimport Button from './Button';\nimport MyAccount from './MyAccount';\n\nexport default function Student(props) {\n    const { student, wearables } = props;\n    const [view, setView] = useState('home');\n    const [avatar, setAvatar] = useState(null);\n    useEffect(() => {\n        // the following function converts student.avatar, which is an array of string IDs, to an object with category names as keys\n        const createAvatarObject = (avatarArray) => avatarArray.reduce((obj, id) => {\n            const index = wearables.findIndex(element => element._id === id);\n            const { category, _id, name, src, image } = wearables[index];\n            obj[category] = { _id, name, src, image };\n            return obj;\n        }, {});\n        setAvatar(createAvatarObject(student.avatar));\n    }, [student.avatar, view]);\n    const closet = student.closet.map(_id => { // converting student.closet, which is an array of string IDs, to an array of objects\n        const index = wearables.findIndex(element => element._id === _id);\n        const thisWearable = wearables[index];\n        return thisWearable;\n    });\n    const formatCoins = (number) => number.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, \",\");\n    const state = {\n        view,\n        avatar,\n        closet,\n        updateView: setView,\n        updateAvatar: setAvatar\n    }\n    return (\n        <Dashboard teacher={false}>\n            <Header {...props} {...state}>\n                <Nav>\n                    <button className=\"stealth\" onClick={() => setView('home')}>Home</button>\n                    <button className=\"stealth\" onClick={() => setView('closet')}>Closet</button>\n                    <button className=\"stealth\" onClick={() => setView('marketplace')}>Marketplace</button>\n                    <button className=\"stealth\" onClick={() => setView('badges')}>Badges</button>\n                </Nav>\n                <StudentProfileDropdown {...props} {...state} />\n            </Header>\n            <Sidebar>\n                <div className=\"StudentSidebar\">\n                    <div className=\"avatarContainer\">\n                        <Avatar {...props} {...state} />\n                    </div>\n                    <div className=\"studentStats\">\n                        <img className=\"statsIcon\" alt=\"coin icon\" src=\"assets/Coin_ico.png\" />\n                        <span className=\"statsLabel\" onClick={() => setView('marketplace')}>{formatCoins(student.coins)}</span>\n                        <img className=\"statsIcon\" alt=\"badge icon\" src=\"assets/Badge_ico.svg\" />\n                        <span className=\"statsLabel\" onClick={() => setView('badges')}>{student.badges.length.toString()}</span>\n                    </div>\n                </div>\n            </Sidebar>\n            <Main {...props} {...state} />\n        </Dashboard>\n    );\n}\n\nfunction StudentProfileDropdown(props) {\n    const { student } = props;\n    const [expanded, setExpanded] = useState(false);\n    const toggleExpanded = () => setExpanded(prevState => !prevState);\n    return (\n        <div className={`User ${expanded ? ' expanded' : ''}`}>\n            <button onClick={toggleExpanded}>\n                <span className=\"name\">{student.firstName}</span>\n                <span className=\"caret\"></span>\n            </button>\n            <div className=\"pfp\" onClick={toggleExpanded}>\n                <img alt=\"pfp\" src={student.profilePic ? student.profilePic : 'assets/defaultpfp.jpg' } />\n            </div>\n            <ContextMenu\n              position={null}\n              ignoreClick={['.User .pfp', '.User > button']}\n              updateContextMenu={() => setExpanded(false)}\n              children={(\n                <ul>\n                    <li><button className=\"myAccount\" onClick={() => props.updateView('account')}>My Account</button></li>\n                    <li><button className=\"settings\" onClick={() => props.updateView('settings')}>Settings</button></li>\n                    <li><button className=\"logout\" onClick={props.logout}>Logout</button></li>\n                </ul>\n            )} />\n        </div>\n    )\n}\n\nfunction Main(props) {\n    const { view, student } = props;\n    switch (view) {\n        case 'home': return <Homework {...props} />;\n        case 'closet': return <StudentCloset {...props} />\n        case 'marketplace': return <StudentMarketplace {...props} />;\n        case 'badges': return <StudentBadges {...props} />;\n        case 'account': return <MyAccount {...props} userType=\"student\" user={student} />;\n        default: return <Homework {...props} />;\n    }\n}\n\nfunction Homework(props) {\n    const { student } = props;\n    const [homework, setHomework] = useState(null);\n    const getHomework = async () => {\n        const response = await fetch(`/student/${student._id}/homework`);\n        const body = await response.json();\n        if (!body) return console.log('no response from server');\n        if (!body.success) return console.log('no { success: true } response from server');\n        setHomework(body.homework);\n    }\n    useEffect(() => {\n        getHomework();\n    }, []);\n    const generateHomeworkModules = () => {\n        return homework.map(homework => (\n            <HomeworkModule key={`homeworkModule-${homework._id}`} {...props} {...homework} refreshHomework={getHomework} />\n        ));\n    };\n    return (\n        <div className=\"Main\">\n            <h1>My Homework Tracker</h1>\n            <div className=\"ViewHomework\">\n                {homework ? generateHomeworkModules() : ''}\n            </div>\n        </div>\n    );\n}\n\nfunction HomeworkModule(props) {\n    const { _id, date, headline, assignments } = props;\n    const homeworkAssignments = () => {\n        return assignments.map((info, index) => (\n            <Assignment key={`homeworkAssignment-${_id}-${index}`} {...props} index={index} {...info} _id={_id} />\n        ));\n    }\n    return (\n        <div className=\"Homework\">\n            <div className=\"homeworkHeader\">\n                <div>\n                    <span className=\"date\">{prettifyDate(date)}</span>\n                    <h3>{headline}</h3>\n                </div>\n            </div>\n            <div className=\"homeworkBody\">\n                <ul>\n                    <li className=\"smol\">\n                        <div>Assignments</div>\n                        <div>Progress</div>\n                    </li>\n                </ul>\n                <ol>\n                    {homeworkAssignments()}\n                </ol>\n            </div>\n        </div>\n    );\n}\n\nfunction Assignment(props) {\n    const { _id, index, label, progress, recorded } = props;\n    const updateHomeworkProgress = async (value) => {\n        // todo don't wait for server response to visually update UI!!!\n        const response = await fetch(`/assignment/${_id}/progress`, {\n            method: 'PUT',\n            headers: {\n                'Content-Type': 'application/json'\n            },\n            body: JSON.stringify({\n                index,\n                value\n            })\n        });\n        const body = await response.json();\n        if (!body) return console.log('no response from server');\n        if (!body.success) return console.log('no { success: true } response from server');\n        props.refreshHomework();\n    }\n    return (\n        <li>\n            <div>\n                <div>{label}</div>\n                <div className=\"progress\">\n                    <button onClick={progress === 0 ? () => {} : () => updateHomeworkProgress(progress - 1)}\n                        className={`stealth${progress === 0 ? ' disabled' : ''}`}\n                        style={{ visibility: recorded ? 'hidden' : 'visible' }}><i className=\"fas fa-minus-circle\"></i></button>\n                    <ProgressBar percentage={(100 * progress) / 4} />\n                    <button onClick={progress === 4 ? () => {} : () => updateHomeworkProgress(progress + 1)}\n                        className={`stealth${progress === 4 ? ' disabled' : ''}`}\n                        style={{ visibility: recorded ? 'hidden' : 'visible' }}><i className=\"fas fa-plus-circle\"></i></button>\n                </div>\n            </div>\n        </li>\n    )\n}\n\nfunction ProgressBar(props) {\n    const { percentage } = props;\n    return (\n        <div className=\"ProgressBar\">\n            <div className=\"bar\" style={{ width: percentage + '%' }}></div>\n        </div>\n    )\n}\n\nfunction StudentMarketplace(props) {\n    return (\n        <div className=\"Main\">\n            <div className=\"StudentMarketplace\">\n                <h1>Marketplace</h1>\n                <Marketplace {...props} />\n            </div>\n        </div>\n    );\n}\n\nfunction StudentCloset(props) {\n    const { student, avatar } = props;\n    const handleUpdateAvatar = async () => {\n        const updatedAvatar = Object.keys(avatar).map(key => avatar[key]._id);\n        const response = await fetch(`student/${student._id}/avatar`, {\n            method: 'PUT',\n            headers: {\n                'Content-Type': 'application/json'\n            },\n            body: JSON.stringify({\n                avatar: updatedAvatar\n            })\n        });\n        const body = await response.json();\n        if (!body) return console.log('no response from server');\n        if (!body.success) return console.log('no success response from server');\n        props.refreshData();\n    }\n    const unsavedChanges = () => {\n        // there has got to be a better way todo this\n        const previewAvatar = Object.keys(avatar).map(key => avatar[key]._id);\n        const trueAvatar = student.avatar;\n        if (trueAvatar.length !== previewAvatar.length) return true;\n        const trueAvatarObject = {};\n        const previewAvatarObject = {};\n        for (let id of trueAvatar) trueAvatarObject[id] = true;\n        for (let id of previewAvatar) previewAvatarObject[id] = true;\n        // checking if the two arrays have equal contents (regardless of order)\n        if ((previewAvatar.every(string => trueAvatarObject[string]))\n        && (trueAvatar.every(string => previewAvatarObject[string]))) {\n            return false;\n        }\n        else return true;\n    }\n    return (\n        <div className=\"Main\">\n            <h1>Closet</h1>\n            <Closet {...props} />\n            {unsavedChanges() && <div className=\"buttons\"><Button onClick={handleUpdateAvatar} className=\"slideUpIn\">Save Changes</Button></div>}\n        </div>\n    );\n}\n\nfunction StudentBadges(props) {\n    const { student, badges } = props;\n    const badgesRef = useRef({});\n    const generateBadgeList = () => {\n        if (!student.badges.length) return \"You haven't earned any badges yet!\";\n        return badges.map(badge => {\n            const index = student.badges.findIndex(object => object.id === badge._id);\n            const studentHasBadge = index !== -1;\n            const badgeHasBeenRedeemed = () => {\n                if (!studentHasBadge) return;\n                if (student.badges[index].redeemed) return true;\n                return false;\n            }\n            const redeemBadge = async () => {\n                if (badgeHasBeenRedeemed()) return;\n                badgesRef.current[badge._id].classList.add('redeemed');\n                const response = await fetch(`/student/${student._id}/badge/redeemed`, {\n                    method: 'PUT',\n                    headers: {\n                        'Content-Type': 'application/json'\n                    },\n                    body: JSON.stringify({\n                        badgeId: badge._id,\n                        badgeValue: badge.value\n                    })\n                });\n                const body = await response.json();\n                if (!body) return console.log('no response from server');\n                if (!body.success) return console.log('no success response from server');\n                props.refreshData();\n            }\n            if (studentHasBadge) return (\n                <div\n                  key={`badgeList-${badge._id}`}\n                  ref={(el) => badgesRef.current[badge._id] = el}\n                  className={`badgeItem${badgeHasBeenRedeemed() ? ' redeemed' : ''}`}>\n                    <img\n                        className=\"badgeImage\"\n                        alt={badge.name}\n                        src={badge.src} />\n                    <span className=\"badgeName\">{badge.name}</span>\n                    <span onClick={redeemBadge}>\n                        <img className=\"coin\" alt=\"coin icon\" src=\"assets/Coin_ico.png\" />\n                        <span className=\"badgeValue\">{badge.value}</span>\n                    </span>\n                </div>\n            );\n        });\n    }\n    return (\n        <div className=\"Main\">\n            <div className=\"StudentBadges\">\n                <h1>My Badges</h1>\n                <div className=\"BadgeList\">\n                    {generateBadgeList()}\n                </div>\n            </div>\n        </div>\n    );\n}","/Users/ngw/Documents/Sites/Pianopet/client/src/components/Teacher.js",["118","119"],"import { useState, useEffect, useRef } from 'react';\nimport { Dashboard, Header, Sidebar, Nav } from './Dashboard';\nimport ViewStudent from './ViewStudent';\nimport Marketplace, { AddOrEditWearable } from './Marketplace';\nimport Loading from './Loading';\nimport ContextMenu from './ContextMenu';\nimport { shrinkit } from '../utils';\nimport MyAccount from './MyAccount';\nimport Dropdown from './Dropdown';\n\nexport default function Teacher(props) {\n    const { teacher } = props;\n    const [view, setView] = useState({ type: 'home' });\n    const [students, setStudents] = useState([]);\n    const [wearables, setWearables] = useState([]);\n    const [badges, setBadges] = useState([]);\n    const getTeacherData = async () => {\n        const response = await fetch(`/teacher/${teacher._id}`);\n        const body = await response.json();\n        if (!body) return console.log('no response from server');\n        if (!body.success) return console.log('no success response from server');\n        setStudents(body.students);\n        setWearables(body.wearables);\n        setBadges(body.badges);\n        if (view.type === 'student') {\n            const refreshCurrentStudent = (prevView) => {\n                let thisStudent = prevView.data;\n                let index = body.students.findIndex(student => student._id === thisStudent._id);\n                return body.students[index];\n            }\n            setView(prevView => ({\n                type: 'student',\n                data: refreshCurrentStudent(prevView)\n            }));\n        }\n    }\n    useEffect(() => {\n        getTeacherData();\n    }, [teacher._id]);\n    const generateStudentList = () => {\n        if (!students.length) return 'No students yet!';\n        const makeSureNameFits = (string) => {\n            if (string.length < 18) return string;\n            let shortenedString = string.substring(0, 17);\n            return shortenedString + '...';\n        }\n        const studentList = students.map(student => ({\n            value: student._id,\n            display: makeSureNameFits(student.firstName + ' ' + student.lastName)\n        }));\n        return (\n            <Dropdown\n                style={{ minWidth: '14rem' }}\n                restoreDefault={view.type !== 'student'}\n                defaultValue={{ value: null, display: 'Select one...' }}\n                listItems={studentList}\n                onChange={(_id) => setView({ type: 'student', data: students[students.findIndex(student => student._id === _id)] })}\n            />\n        );\n    }\n    const state = {\n        view,\n        students,\n        wearables,\n        badges,\n        updateView: setView,\n        refreshData: getTeacherData\n    }\n    return (\n        <Dashboard teacher={true}>\n            <Header>\n                <Nav>\n                    <button onClick={() => setView({ type: 'home' })}>Home</button>\n                    <button onClick={() => setView({ type: 'marketplace' })}>Marketplace</button>\n                    <button onClick={() => setView({ type: 'badges' })}>Badges</button>\n                </Nav>\n                <TeacherProfileDropdown {...props} {...state} />\n            </Header>\n            <Sidebar>\n                <h2>Students</h2>\n                {generateStudentList()}\n                <hr />\n                <div className=\"teacherCode\">\n                    Teacher code:<br />\n                    <b style={{ fontSize: '0.8rem' }}>{teacher._id}</b>\n                </div>\n            </Sidebar>\n            <Main {...props} {...state} />\n        </Dashboard>\n    );\n}\n\nfunction TeacherProfileDropdown(props) {\n    const { teacher } = props;\n    const [expanded, setExpanded] = useState(false);\n    const toggleExpanded = () => setExpanded(prevState => !prevState);\n    return (\n        <div className={`User${expanded ? ' expanded' : ''}`}>\n            <button onClick={toggleExpanded}>\n                <span className=\"name\">{teacher.firstName}</span>\n                <span className=\"caret\"></span>\n            </button>\n            <div className=\"pfp\" onClick={toggleExpanded}>\n                <img alt=\"pfp\" src={teacher.profilePic ? teacher.profilePic : 'assets/defaultpfp.jpg' } />\n            </div>\n            <ContextMenu\n              position={null}\n              ignoreClick={['.User .pfp', '.User > button']}\n              updateContextMenu={() => setExpanded(false)}\n              children={(\n                <ul>\n                    <li><button className=\"myAccount\" onClick={() => props.updateView({ type: 'account' })}>My Account</button></li>\n                    <li><button className=\"settings\" onClick={() => props.updateView({ type: 'settings' })}>Settings</button></li>\n                    <li><button className=\"logout\" onClick={props.logout}>Logout</button></li>\n                </ul>\n            )} />\n        </div>\n    )\n}\n\nfunction Main(props) {\n    const { view, teacher } = props;\n    switch (view.type) {\n        case 'home': return <Home {...props} />;\n        case 'student': return <ViewStudent {...props} student={view.data} />;\n        case 'marketplace': return <TeacherMarketplace {...props} />;\n        case 'badges': return <TeacherBadges {...props} />;\n        case 'account': return <MyAccount {...props} userType=\"teacher\" user={teacher} />;\n        case 'settings': return <Settings {...props} />;\n        default: return <Home {...props} />;\n    }\n}\n\nfunction Home() {\n    return (\n        <div className=\"Main padme\">\n            <h1>Dashboard</h1>\n            <ul>\n                <li>View student dashboard</li>\n                <ul>\n                    <li>Add homework</li>\n                    <li>Log assignment progress</li>\n                    <li>Give coins</li>\n                    <li>Award badges</li>\n                </ul>\n                <li>General - apply to all students</li>\n                <ul>\n                    <li>Add/edit/delete badges</li>\n                    <li>Add/edit/delete closet items</li>\n                </ul>\n            </ul>\n        </div>\n    );\n}\n\nfunction TeacherMarketplace(props) {\n    const { teacher, modal } = props;\n    const [wearableModal, setWearableModal] = useState(false);\n    useEffect(() => {\n        if (!modal) setWearableModal(false);\n    }, [modal]);\n    useEffect(() => {\n        if (wearableModal) addNewWearable();\n    }, [teacher]);\n    const addNewWearable = () => {\n        props.updateModal(<AddOrEditWearable {...props} />);\n        setWearableModal(true);\n    }\n    return (\n        <div className=\"Main\">\n            <h1>Marketplace</h1>\n            <Marketplace {...props} viewingAsTeacher={true} />\n            <button onClick={addNewWearable}>Add new wearable</button>\n        </div>\n    );\n}\n\nfunction TeacherBadges(props) {\n    const addNewBadge = () => {\n        props.updateModal(<AddOrEditBadge {...props} />)\n    }\n    return (\n        <div className=\"Main\">\n            <h1>Badges</h1>\n            <Badges {...props} />\n            <button onClick={addNewBadge}>Add new badge</button>\n        </div>\n    )\n}\n\nfunction Badges(props) {\n    const { badges } = props;\n    const badgesRef = useRef({});\n    const awardBadge = (_id) => {\n        const index = badges.findIndex(badge => badge._id === _id);\n        const thisBadge = badges[index];\n        props.updateModal(<AwardBadge {...props} badge={thisBadge} />);\n    }\n    const editOrDeleteBadge = (e, _id) => {\n        e.preventDefault();\n        const index = badges.findIndex(badge => badge._id === _id);\n        const thisBadge = badges[index];\n        const editBadge = () => props.updateModal(<AddOrEditBadge {...props} badge={thisBadge} />);\n        const deleteBadge = () => {\n            const handleDelete = async () => {\n                props.updateModal(content({ loadingIcon: true }));\n                const response = await fetch(`/badge/${_id}`, { method: 'DELETE' });\n                const body = await response.json();\n                if (!body) return console.log('no response from server');\n                if (!body.success) return console.log('no success response from server');\n                shrinkit(badgesRef.current[_id], true);\n                props.refreshTeacher();\n                props.refreshData();\n                props.updateModal(false);\n            }\n            let content = (options = {\n                loadingIcon: false\n            }) => (\n                <div className=\"modalBox\">\n                    <h2>Are you sure?</h2>\n                    <img alt={thisBadge.name} src={thisBadge.src} style={{ float: 'right' }} />\n                    Are you sure you want to delete the badge \"{thisBadge.name}\"? This action cannot be undone.\n                    <div className=\"buttons\">\n                        {options.loadingIcon\n                            ?   <Loading />\n                            :   <form onSubmit={handleDelete}>\n                                    <button type=\"submit\">Yes, I'm sure</button>\n                                    <button type=\"button\" className=\"greyed\" onClick={() => props.updateModal(false)}>Cancel</button>\n                                </form>\n                            }\n                    </div>\n                </div>\n            )\n            props.updateModal(content());\n        }\n        let content = (\n            <ul className=\"editDelete\">\n                <li><button onClick={editBadge}>Edit</button></li>\n                <li><button onClick={deleteBadge}>Delete</button></li>\n            </ul>\n        );\n        props.updateContextMenu(e, content);\n    }\n    const generateBadgeList = () => {\n        return badges.map(badge => (\n            <div\n              key={`badgeList-${badge._id}`}\n              ref={(el) => badgesRef.current[badge._id] = el}\n              className=\"badgeItem\">\n                <img\n                  alt={badge.name}\n                  src={badge.src}\n                  className=\"badgeImage\"\n                  onClick={() => awardBadge(badge._id)}\n                  onContextMenu={(e) => editOrDeleteBadge(e, badge._id)} />\n                <span className=\"badgeName\">{badge.name}</span>\n                <span>\n                    <img alt=\"coin icon\" className=\"coin\" src=\"assets/Coin_ico.png\" />\n                    <span className=\"badgeValue\">{badge.value}</span>\n                </span>\n            </div>\n        ));\n    }\n    return (\n        <div className=\"BadgeList\">\n            {generateBadgeList()}\n        </div>\n    )\n}\n\nfunction AwardBadge(props) {\n    const { students, badge } = props;\n    const [recipient, setRecipient] = useState(null); // student id\n    const [error, setError] = useState(false);\n    const [loadingIcon, setLoadingIcon] = useState(false);\n    const makeSureNameFits = (string) => {\n        if (string.length < 18) return string;\n        let shortenedString = string.substring(0, 17);\n        return shortenedString + '...';\n    }\n    const studentList = students.map(student => ({\n        value: student._id,\n        display: makeSureNameFits(student.firstName + ' ' + student.lastName)\n    }));\n    const handleSubmit = async (e) => {\n        e.preventDefault();\n        if (!recipient) return setError('Please select a student!');\n        setLoadingIcon(true);\n        const response = await fetch(`/student/${recipient}/badges`, {\n            method: 'PUT',\n            headers: {\n                'Content-Type': 'application/json'\n            },\n            body: JSON.stringify({ badgeId: badge._id })\n        });\n        const body = await response.json();\n        if (!body) return console.log('no response from server');\n        if (!body.success) {\n            setLoadingIcon(false);\n            return setError(body.error);\n        }\n        props.updateModal(false);\n        props.refreshData();\n    }\n    const updateRecipient = (_id) => {\n        setError(false);\n        setRecipient(_id);\n    }\n    return (\n        <div className=\"modalBox\">\n            <h2>Award this badge</h2>\n            <p>Choose a student to award this badge to:</p>\n            <div style={{ textAlign: 'center' }}>\n                <Dropdown\n                    style={{ minWidth: '15rem', marginBottom: '0.2rem' }}\n                    defaultValue={{ value: null, display: 'Select one...' }}\n                    listItems={studentList}\n                    onChange={updateRecipient}/>\n                {error && <span className=\"error\">{error}</span>}\n            </div>\n            <form onSubmit={handleSubmit} className=\"buttons\">\n                {loadingIcon\n                    ? <Loading />\n                    : <input type=\"submit\" />\n                }\n            </form>\n        </div>\n    )\n}\n\nfunction AddOrEditBadge(props) {\n    const { teacher, badge } = props;\n    const [loadingIcon, setLoadingIcon] = useState(false);\n    const [formData, setFormData] = useState({\n        _id: badge ? badge._id : '',\n        teacherCode: badge ? badge.teacherCode : teacher._id,\n        name: badge ? badge.name : '',\n        src: badge ? badge.src : '',\n        value: badge ? badge.value : ''\n    });\n    const updateFormData = (key, value) => {\n        setFormData(prevState => ({\n            ...prevState,\n            [key]: value\n        }));\n    }\n    const handleSubmit = async (e) => {\n        e.preventDefault();\n        setLoadingIcon(true);\n        const ROUTE = badge ? `/badge/${badge._id}` : '/badge';\n        const response = await fetch(ROUTE, {\n            method: badge ? 'PUT' : 'POST',\n            headers: {\n                'Content-Type': 'application/json'\n            },\n            body: JSON.stringify(formData)\n        });\n        const body = await response.json();\n        if (!body) return console.log('no response from server');\n        if (!body.success) return console.log('no success response from server');\n        props.updateModal(false);\n        props.refreshData();\n    }\n    return (\n        <div className=\"modalBox\">\n            <form className=\"pad\" onSubmit={handleSubmit}>\n                <h2>{badge ? 'Edit this' : 'Add new'} badge</h2>\n                <label htmlFor=\"name\">Badge name:</label>\n                <input type=\"text\" defaultValue={badge ? badge.name : ''} onChange={(e) => updateFormData('name', e.target.value)} />\n                <label htmlFor=\"src\">Image link:</label>\n                <input type=\"text\" defaultValue={badge ? badge.src : ''} onChange={(e) => updateFormData('src', e.target.value)} />\n                <label htmlFor=\"value\">Badge value:</label>\n                <input type=\"text\" defaultValue={badge ? badge.value : ''} onChange={(e) => updateFormData('value', e.target.value)} />\n                <div className=\"buttons\">\n                    {loadingIcon\n                        ? <Loading />\n                        : <input type=\"submit\" />\n                    }\n                </div>\n            </form>\n        </div>\n    )\n}\n\nfunction Settings(props) {\n    return (\n        <div className=\"Main\">\n            <h1>Settings</h1>\n        </div>\n    );\n}","/Users/ngw/Documents/Sites/Pianopet/client/src/components/Marketplace.js",["120","121","122"],"import { useState, useEffect, useRef } from 'react';\nimport Loading from './Loading';\nimport { shrinkit } from '../utils';\nimport Dropdown from './Dropdown';\nimport PianopetBase from './PianopetBase';\nimport Splat from './Splat';\nimport { ntc } from '../utils/ntc';\n\nexport default function Marketplace(props) {\n    const { viewingAsTeacher, student, avatar, teacher, wearables, isMobile } = props;\n    const [preview, setPreview] = useState(null);\n    const [category, setCategory] = useState(() => teacher.wearableCategories[0]);\n    const wearableRefs = useRef({});\n    useEffect(() => {\n        setPreview(avatar);\n    }, [avatar]);\n    const updatePreview = ({ category, _id, name, src, value, image }) => {\n        const updatePreviewFor = (object) => {\n            let setObject;\n            if (object === 'preview') setObject = setPreview;\n            if (object === 'avatar') setObject = props.updateAvatar;\n            if (object[category] && object[category].name === name) {\n                const previewObjectMinusCategory = (prevState) => {\n                    const object = {...prevState};\n                    delete object[category];\n                    return object;\n                }\n                setObject(prevState => ({\n                    ...previewObjectMinusCategory(prevState)\n                }));\n                return;\n            }\n            setObject(prevState => ({\n                ...prevState,\n                [category]: { _id, name, src, value, image }\n            }));\n        }\n        if (isMobile) updatePreviewFor('avatar');\n        else updatePreviewFor('preview');\n    }\n    const teacherOperations = {\n        addColor: () => {\n            const content = (<AddOrEditColor {...props} />);\n            props.updateModal(content);\n        },\n        editOrDeleteWearable: (e, _id, type) => {\n            e.preventDefault();\n            if (!viewingAsTeacher) return;\n            const index = wearables.findIndex(wearable => wearable._id === _id);\n            const thisWearable = wearables[index];\n            const dialog = type === 'color'\n                ? <AddOrEditColor {...props} wearable={thisWearable} />\n                : <AddOrEditWearable {...props} wearable={thisWearable} />;\n            const editWearable = () => props.updateModal(dialog);\n            const deleteWearable = () => {\n                const handleDelete = async (e) => {\n                    e.preventDefault();\n                    props.updateModal(content({ loadingIcon: true }));\n                    const response = await fetch(`/wearable/${_id}`, { method: 'DELETE' });\n                    const body = await response.json();\n                    if (!body) return console.log('no response from server');\n                    if (!body.success) return console.log('no success response from server');\n                    shrinkit(wearableRefs.current[_id], true);\n                    props.refreshTeacher();\n                    props.refreshData();\n                    props.updateModal(false);\n                }\n                let content = (options = {\n                    loadingIcon: false\n                }) => (\n                    <div className=\"modalBox hasImage\">\n                        <div>\n                            <h2>Are you sure?</h2>\n                            Are you sure you want to delete the wearable \"{thisWearable.name}\"? This action cannot be undone.\n                            <div className=\"buttons\">\n                                {options.loadingIcon\n                                    ?   <Loading />\n                                    :   <form onSubmit={handleDelete}>\n                                            <button type=\"submit\">Yes, I'm sure</button>\n                                            <button type=\"button\" className=\"greyed\" onClick={() => props.updateModal(false)}>Cancel</button>\n                                        </form>\n                                    }\n                            </div>\n                        </div>\n                        <div className=\"flex center\">\n                            <img alt={thisWearable.name} src={thisWearable.src} />\n                        </div>\n                    </div>\n                )\n                props.updateModal(content());\n            }\n            let content = (\n                <ul className=\"editDelete\">\n                    <li><button onClick={editWearable}>Edit</button></li>\n                    <li><button onClick={deleteWearable}>Delete</button></li>\n                </ul>\n            );\n            props.updateContextMenu(e, content);\n        },\n        addOrEditCategory: (e, originalName) => {\n            e.preventDefault();\n            if (!viewingAsTeacher) return;\n            const editingCategory = teacher.wearableCategories.includes(originalName);\n            const handleAddOrEditCategory = async (e, categoryName) => {\n                e.preventDefault();\n                props.updateModal(content({ loadingIcon: true }));\n                const fromDropdown = !!categoryName;\n                const formData = editingCategory\n                    ?   { originalName, updatedName: e.target[0].value }\n                    :   { categoryName: fromDropdown ? categoryName : e.target[0].value }\n                const response = await fetch(`/teacher/${teacher._id}/wearable-category`, {\n                    method: 'POST',\n                    headers: {\n                        'Content-Type': 'application/json'\n                    },\n                    body: JSON.stringify(formData)\n                });\n                const body = await response.json();\n                if (!body) return console.log('no response from server');\n                if (!body.success) return console.log('no success response from server');\n                props.refreshTeacher();\n                if (editingCategory) {\n                    props.refreshData(); // in case any wearables were affected by category name change\n                    if (category === originalName) setCategory(e.target[0].value);\n                }\n                props.updateModal(false);\n            }\n            let content = (options = {\n                loadingIcon: false\n            }) => (\n                <div className=\"modalBox\">\n                    <h2>{editingCategory ? 'Edit' : 'Add new'} category</h2>\n                    <form onSubmit={handleAddOrEditCategory} autoComplete=\"off\">\n                        <label htmlFor=\"categoryName\">Category name:</label>\n                        <input type=\"text\" name=\"categoryName\" defaultValue={editingCategory ? originalName : ''} />\n                        <div className=\"buttons\">\n                            {options.loadingIcon\n                                ? <Loading />\n                                : <input type=\"submit\" />\n                            }\n                        </div>\n                    </form>\n                </div>\n            );\n            if (originalName === 'Color') content = (\n                <div className=\"modalBox\">\n                    <h2>Not allowed</h2>\n                    Sorry, this is a default category and can't be renamed.\n                    <div className=\"buttons\"><button onClick={() => props.updateModal(false)}>Go back</button></div>\n                </div>\n            )\n            props.updateModal(content);\n        },\n        editCategory: (e, categoryName) => {\n            if (!viewingAsTeacher) return;\n            e.preventDefault();\n            let content = (\n                <ul className=\"editDelete\">\n                    <li><button onClick={(e) => teacherOperations.addOrEditCategory(e, categoryName)}>Edit</button></li>\n                </ul>\n            );\n            props.updateContextMenu(e, content);\n        }\n    }\n    const studentOperations = {\n        buyWearable: ({ _id, name, src, value, image }) => {\n            if (viewingAsTeacher) return;\n            const buyingColor = !image;\n            const handleSubmit = async (e) => {\n                e.preventDefault();\n                if (student.coins < value) {\n                    let cantAfford = (\n                        <div className=\"modalBox\">\n                            <h2>Not enough coins</h2>\n                            You don't have enough coins to purchase this item. It costs {value} and you only have {student.coins}.\n                            <div className=\"buttons\">\n                                <button type=\"button\" onClick={() => props.updateModal(false)}>OK</button>\n                            </div>\n                        </div>\n                    );\n                    props.updateModal(cantAfford);\n                    return;\n                }\n                props.updateModal(content({ loadingIcon: true }));\n                const response = await fetch(`/student/${student._id}/closet`, {\n                    method: 'PUT',\n                    headers: {\n                        'Content-Type': 'application/json'\n                    },\n                    body: JSON.stringify({\n                        wearableId: _id,\n                        wearableCost: value\n                    })\n                });\n                const body = await response.json();\n                if (!body) return console.log('no response from server');\n                if (!body.success) return console.log('no success response from server');\n                props.refreshData();\n                props.updateModal(false);\n            }\n            let content = (options = {\n                loadingIcon: false\n            }) => (\n                <div className=\"modalBox hasImage\">\n                    <div>\n                        <h2>Confirm purchase</h2>\n                        Are you sure you want to purchase {buyingColor && 'the color'} <b>{name}</b> for <span className=\"coins\"><b>{value}</b>?</span>\n                        <div className=\"buttons\">\n                            {options.loadingIcon\n                                ?   <Loading />\n                                :   <form onSubmit={handleSubmit}>\n                                        <button type=\"submit\">Yes, I'm sure</button>\n                                        <button type=\"button\" className=\"greyed\" onClick={() => props.updateModal(false)}>Cancel</button>\n                                    </form>\n                                }\n                        </div>\n                    </div>\n                    <div className=\"flex center\">\n                        {buyingColor\n                            ? <PianopetBase color={src} zoom={true} />\n                            : <img alt={name} src={src} />\n                        }\n                    </div>\n                </div>\n            );\n            props.updateModal(content());\n        }\n    }\n    const generate = {\n        previewObject: (preview) => {\n            if (isMobile) return null;\n            const images = [];\n            for (let category in preview) {\n                if (category !== 'Color') {\n                    const thisWearable = preview[category];\n                    const style = {\n                        top: `${thisWearable.image.y}%`,\n                        left: `${thisWearable.image.x}%`,\n                        width: `${thisWearable.image.w}%`\n                    }\n                    images.push(\n                        <img\n                          key={`marketplacePreview-${category}`}\n                          className={`previewWearable ${category}`}\n                          src={thisWearable.src}\n                          style={style}\n                        />\n                    );\n                }\n            }\n            return (\n                <div className=\"previewBox\">\n                    {preview && <PianopetBase color={preview.Color.src} />}\n                    {images}\n                </div>\n            );\n        },\n        previewDescription: (preview) => {\n            if (viewingAsTeacher || isMobile) return;\n            const previewItems = [];\n            for (let category in preview) {\n                previewItems.push(\n                    <li key={`marketplacePreviewDescription-${category}`}>\n                        <span className=\"wearableName\">{preview[category].name}</span>\n                        {!viewingAsTeacher && student.closet.includes(preview[category]._id)\n                            ?   <span className=\"owned\"></span>\n                            :   <button onClick={() => studentOperations.buyWearable(preview[category])}>\n                                    <img className=\"coin\" alt=\"coin icon\" src=\"assets/Coin_ico.png\" />\n                                    <span className=\"wearableValue\">{preview[category].value}</span>\n                                </button>\n                            }\n                    </li>\n                )\n            }\n            return (\n                <ul>\n                    <h3>Previewing:</h3>\n                    {previewItems}\n                </ul>\n            );\n        },\n        categoriesList: (categories) => {\n            const array = categories.map(category => (\n                <button\n                  key={`wearableCategories-toolbar-${category}`}\n                  onClick={() => setCategory(category)}\n                  onContextMenu={(e) => teacherOperations.editCategory(e, category)}>\n                    {category}\n                </button>\n            ))\n            if (viewingAsTeacher) array.push(\n                <button key=\"wearableCategories-toolbar-addNew\" className=\"add\" onClick={teacherOperations.addOrEditCategory}></button>\n            );\n            return array;\n        },\n        wearablesList: (category) => {\n            const filteredList = wearables.filter(wearable => wearable.category === category);\n            const list = filteredList.map(wearable => {\n                const ownsWearable = (() => {\n                    if (viewingAsTeacher) return false;\n                    if (student.closet.includes(wearable._id)) return true;\n                    return false;\n                })();\n                const type = category === 'Color' ? 'color' : 'wearable';\n                return (\n                    <button\n                      ref={(el) => wearableRefs.current[wearable._id] = el}\n                      key={`${category}-wearable-${wearable.name}`}\n                      className={ownsWearable ? 'owned' : ''}\n                      onClick={() => updatePreview(wearable)}\n                      onContextMenu={(e) => teacherOperations.editOrDeleteWearable(e, wearable._id, type)}>\n                        {wearable.category === 'Color'\n                            ? <Splat color={wearable.src} />\n                            : <img alt={wearable.name} src={wearable.src} />}\n                        <span>{wearable.name}</span>\n                        <span>\n                            <img alt=\"coin icon\" src=\"assets/Coin_ico.png\" />\n                            <span>{wearable.value}</span>\n                        </span>\n                    </button>\n                )\n            });\n            if (viewingAsTeacher && category === 'Color') list.push(\n                <button key=\"color-wearable-addNew\" className=\"add\" onClick={teacherOperations.addColor}></button>\n            );\n            if (category === 'Color') list.splice(0, 0, (\n                <button\n                    ref={(el) => wearableRefs.current['default'] = el}\n                    key={`${category}-wearable-defaultColor`}\n                    className={viewingAsTeacher ? null : \"owned\"}\n                    onClick={() => updatePreview({ category: 'Color', src: '#5C76AE' })}>\n                    <Splat color=\"#5C76AE\" />\n                    <span>Default</span>\n                    <span>\n                        <img alt=\"coin icon\" src=\"assets/Coin_ico.png\" />\n                        <span>0</span>\n                    </span>\n                </button>\n            ));\n            return list;\n        }\n    }\n    return (\n        <div className=\"Marketplace\">\n            <div className=\"marketplacePreview\">\n                {generate.previewObject(preview)}\n                {generate.previewDescription(preview)}\n            </div>\n            <div className=\"wearableCategories\">\n                {generate.categoriesList(teacher.wearableCategories)}\n            </div>\n            <div className=\"wearablesList\">\n                <div className={category === 'Color' ? 'blobs' : null}>\n                    {generate.wearablesList(category)}\n                </div>\n            </div>\n        </div>\n    );\n}\n\nfunction AddOrEditColor(props) {\n    const { teacher, wearable } = props;\n    const [loadingIcon, setLoadingIcon] = useState(false);\n    const [formData, setFormData] = useState({\n        teacherCode: teacher._id,\n        name: wearable ? wearable.name : '',\n        category: 'Color',\n        src: wearable ? wearable.src : '#' + Math.floor(Math.random()*16777215).toString(16),\n        value: wearable ? wearable.value : ''\n    });\n    const colorInput = useRef(null);\n    const addingColor = !wearable;\n    const updateFormData = (e) => {\n        setFormData(prevState => ({\n            ...prevState,\n            [e.target.name]: e.target.value\n        }));\n    }\n    const handleSubmit = async (e) => {\n        e.preventDefault();\n        setLoadingIcon(true);\n        const ROUTE = wearable ? `/wearable/${wearable._id}` : '/wearable';\n        const response = await fetch(ROUTE, {\n            method: wearable ? 'PUT' : 'POST',\n            headers: {\n                'Content-Type': 'application/json'\n            },\n            body: JSON.stringify(formData)\n        });\n        const body = await response.json();\n        if (!body) return console.log('no response from server');\n        if (!body.success) return console.log('no success response from server');\n        props.updateModal(false);\n        props.refreshData();\n    }\n    return (\n        <div className=\"modalBox\">\n            <form onSubmit={handleSubmit} autoComplete=\"off\">\n                <h2>{addingColor ? 'Add a new' : 'Edit this'} color</h2>\n                {addingColor ? 'Add a new' : 'Edit this'} color by clicking on the Pianopet icon below.\n                <div className=\"colorPicker\">\n                    <div>\n                        <PianopetBase color={formData.src} zoom={true} />\n                        <input name=\"src\" type=\"color\" defaultValue={formData.src} onChange={updateFormData} ref={colorInput} />\n                        <span onClick={() => colorInput.current.click()}></span>\n                    </div>\n                    <div>\n                        <label htmlFor=\"name\">Color name:</label>\n                        <input\n                            name=\"name\"\n                            type=\"text\"\n                            placeholder={`How about ${ntc.name(formData.src)[1]}?`}\n                            defaultValue={formData.name}\n                            onChange={updateFormData} />\n                    </div>\n                    <div>\n                        <label htmlFor=\"value\">Cost:</label>\n                        <input name=\"value\" type=\"text\" defaultValue={formData.value} onChange={updateFormData} />\n                    </div>\n                </div>\n                {addingColor || <div className=\"tip\" style={{ marginTop: '1rem' }}>Tip: Clear the text box to see color name suggestions!</div>}\n                {loadingIcon\n                    ?   <Loading />\n                    :   <div className=\"buttons\">\n                            <button type=\"submit\">Submit</button>\n                            <button type=\"button\" className=\"greyed\" onClick={() => props.updateModal(false)}>Cancel</button>\n                        </div>\n                    }\n            </form>\n        </div>\n    );\n}\n\nexport function AddOrEditWearable(props) {\n    const { teacher, wearable } = props;\n    const [loadingIcon, setLoadingIcon] = useState(false);\n    const [formData, setFormData] = useState({\n        teacherCode: wearable ? wearable.teacherCode : teacher._id,\n        name: wearable ? wearable.name : '',\n        category: wearable ? wearable.category : teacher.wearableCategories[0],\n        src: wearable ? wearable.src : '',\n        value: wearable ? wearable.value : '',\n        image: {\n            w: wearable && wearable.image ? wearable.image.w : 50,\n            x: wearable && wearable.image ? wearable.image.x : 10,\n            y: wearable && wearable.image ? wearable.image.y : 40\n        }\n    });\n    const updateFormData = (key, value) => {\n        setFormData(prevState => ({\n            ...prevState,\n            [key]: value\n        }));\n    }\n    const updateImage = (newStuff) => {\n        setFormData(prevState => ({\n            ...prevState,\n            image: {\n                ...prevState.image,\n                ...newStuff\n            }\n        }));\n    }\n    const handleSubmit = async (e) => {\n        e.preventDefault();\n        setLoadingIcon(true);\n        const ROUTE = wearable ? `/wearable/${wearable._id}` : '/wearable';\n        const response = await fetch(ROUTE, {\n            method: wearable ? 'PUT' : 'POST',\n            headers: {\n                'Content-Type': 'application/json'\n            },\n            body: JSON.stringify(formData)\n        });\n        const body = await response.json();\n        if (!body) return console.log('no response from server');\n        if (!body.success) return console.log('no success response from server');\n        props.updateModal(false);\n        props.refreshData();\n    }\n    const addCategory = async (categoryName) => {\n        const response = await fetch(`/teacher/${teacher._id}/wearable-category`, {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json'\n            },\n            body: JSON.stringify({\n                _id: teacher._id,\n                categoryName\n            })\n        });\n        const body = await response.json();\n        if (!body) return console.log('no response from server');\n        if (!body.success) return console.log('no success response from server');\n        props.refreshTeacher();\n    }\n    const dropdownListItems = () => {\n        const listItems = teacher.wearableCategories.map(item => ({\n            value: item,\n            display: item\n        }));\n        return listItems;\n    }\n    return (\n        <div className=\"modalBox\">\n            <h2>Add new wearable</h2>\n            <form className=\"pad\" onSubmit={handleSubmit}>\n                <div className=\"addWearableForm\">\n                    <div>\n                        <label htmlFor=\"name\">Wearable name:</label>\n                        <input\n                            type=\"text\"\n                            defaultValue={wearable ? wearable.name : ''}\n                            onChange={(e) => updateFormData('name', e.target.value)} />\n                        <label htmlFor=\"value\">Category:</label>\n                        <Dropdown\n                            minWidth=\"10rem\"\n                            defaultValue={{ value: formData.category, display: formData.category }}\n                            listItems={dropdownListItems()}\n                            addNew={addCategory}\n                            onChange={(value) => updateFormData('category', value)} />\n                        <label htmlFor=\"src\">Image link:</label>\n                        <input type=\"text\" defaultValue={wearable ? wearable.src : ''} onChange={(e) => updateFormData('src', e.target.value)} />\n                        <label htmlFor=\"value\">Wearable value:</label>\n                        <input type=\"text\" defaultValue={wearable ? wearable.value : ''} onChange={(e) => updateFormData('value', e.target.value)} />\n                    </div>\n                    <AddOrEditWearablePreview src={formData.src} image={formData.image} updateImage={updateImage} />\n                </div>\n                <div className=\"buttons\">\n                    {loadingIcon\n                        ? <Loading />\n                        : <input type=\"submit\" />\n                    }\n                </div>\n            </form>\n        </div>\n    );\n}\n\nfunction AddOrEditWearablePreview(props) {\n    const { src, image } = props;\n    const [mouseIsDown, setMouseIsDown] = useState(false);\n    const [mouseIsMoving, setMouseIsMoving] = useState(false);\n    const [elementPosition, setElementPosition] = useState({\n        x: 0,\n        y: 0\n    });\n    const [elementOffset, setElementOffset] = useState(null);\n    const preview = useRef(null);\n    const draggable = useRef(null);\n    useEffect(() => {\n        const draggableObject = draggable.current;\n        const previewBox = preview.current;\n        if (!draggableObject || !previewBox) return;\n        setElementPosition({\n            x: (image.x * previewBox.scrollWidth) / 100,\n            y: (image.y * previewBox.scrollHeight) / 100\n        });\n        const mouseup = () => setMouseIsDown(false);\n        const mousedown = (e) => {\n            setMouseIsDown(e);\n            window.addEventListener('mouseup', mouseup);\n        }\n        draggableObject.addEventListener('mousedown', mousedown);\n        return () => {\n            draggableObject.removeEventListener('mousedown', mousedown);\n            window.removeEventListener('mouseup', mouseup);\n        }\n    }, []);\n    useEffect(() => {\n        const previewBox = preview.current;\n        const mousemove = (e) => {\n            e.preventDefault();\n            setMouseIsMoving(e);\n        }\n        if (!mouseIsDown) {\n            setMouseIsDown(false);\n            setMouseIsMoving(false);\n            const calculateImageCoords = () => ({\n                x: (elementPosition.x * 100) / previewBox.scrollWidth,\n                y: (elementPosition.y * 100) / previewBox.scrollHeight\n            });\n            props.updateImage(calculateImageCoords());\n            previewBox.removeEventListener('mousemove', mousemove);\n            return;\n        }\n        const e = mouseIsDown;\n        const calculateElementOffset = (e) => {\n            const mouseX = e.clientX - previewBox.getBoundingClientRect().left;\n            const mouseY = e.clientY - previewBox.getBoundingClientRect().top;\n            const offsetX = mouseX - elementPosition.x;\n            const offsetY = mouseY - elementPosition.y;\n            setElementOffset({\n                x: offsetX,\n                y: offsetY\n            });\n        }\n        calculateElementOffset(e);\n        previewBox.addEventListener('mousemove', mousemove);\n        return () => previewBox.removeEventListener('mousemove', mousemove);\n    }, [mouseIsDown]);\n    useEffect(() => {\n        if (!mouseIsMoving) return;\n        const previewBox = preview.current;\n        const e = mouseIsMoving;\n        const mouseX = e.clientX - previewBox.getBoundingClientRect().left;\n        const mouseY = e.clientY - previewBox.getBoundingClientRect().top;\n        setElementPosition({\n            x: mouseX - elementOffset.x,\n            y: mouseY - elementOffset.y\n        });\n    }, [mouseIsMoving, elementOffset]);\n    const updateImageSize = (e) => {\n        e.preventDefault();\n        const percentage = parseInt(e.target.value) + 1;\n        const draggableObject = draggable.current;\n        draggableObject.style.width = percentage + '%';\n        props.updateImage({ w: percentage });\n    }\n    return (\n        <div>\n            <label>Preview:</label>\n            <div className=\"previewBox\">\n                <div ref={preview}>\n                    <PianopetBase />\n                    <img\n                    alt=\"preview\"\n                    src={src}\n                    ref={draggable}\n                    className={`draggable${mouseIsDown ? ' dragging' : ''}`}\n                    style={{\n                        width: image.w + '%',\n                        transform: `translate3d(${elementPosition.x}px, ${elementPosition.y}px, 0)`\n                        }} />\n                </div>\n            </div>\n            <input type=\"range\" defaultValue={image.w - 1} min=\"0\" max=\"99\" onChange={updateImageSize} />\n        </div>\n    );\n}","/Users/ngw/Documents/Sites/Pianopet/client/src/components/ViewStudent.js",["123"],"import { useState, useEffect, useRef } from 'react';\nimport Loading from './Loading';\nimport Avatar from './Avatar';\nimport { prettifyDate } from '../utils';\nimport dayjs from 'dayjs';\nimport ContextMenu from './ContextMenu';\n\nexport default function ViewStudent(props) {\n    const { student, wearables } = props;\n    const [homework, setHomework] = useState([]);\n    const [avatar, setAvatar] = useState(null);\n    const [isLoaded, setIsLoaded] = useState(false);\n    const state = { homework }\n    const getHomework = async () => {\n        const response = await fetch(`/student/${student._id}/homework`);\n        const body = await response.json();\n        if (!body) return console.log('no response from server');\n        if (!body.success) return console.log('no { success: true } response from server');\n        setHomework(body.homework);\n        setIsLoaded(true);\n    }\n    useEffect(() => {\n        setIsLoaded(false);\n        getHomework();\n        // the following function converts student.avatar, which is an array of string IDs, to an object with category names as keys\n        const createAvatarObject = (avatarArray) => avatarArray.reduce((obj, id) => {\n            const index = wearables.findIndex(element => element._id === id);\n            const { category, _id, name, src, image } = wearables[index];\n            obj[category] = { _id, name, src, image };\n            return obj;\n        }, {});\n        setAvatar(createAvatarObject(student.avatar));\n    }, [student._id]);\n    const addNewHomework = () => {\n        let content = (\n            <div className=\"modalBox\">\n                <h2>{`Add homework for ${student.firstName}`}</h2>\n                <AddHomeworkForm {...props} {...state} refreshHomework={getHomework} />\n            </div>\n        )\n        props.updateModal(content);\n    }\n    if (!student) return;\n    if (!isLoaded) return <Loading />;\n    return (\n        <div className=\"Main\">\n            <div className=\"ViewStudent\">\n                <div className=\"viewStudentMain\">\n                    <div className=\"viewStudentHeader\">\n                        <h1>{student.firstName}'s Homework Progress</h1>\n                        <button className=\"stealth\" onClick={addNewHomework}><i className=\"fas fa-plus-circle\"></i></button>\n                    </div>\n                    <ViewHomework {...props} {...state} refreshHomework={getHomework} />\n                </div>\n                <div className=\"viewStudentSidebar\">\n                    <div className=\"avatarContainer\">\n                        <Avatar {...props} avatar={avatar} viewingAsTeacher={true} />\n                    </div>\n                    <StudentCoins {...props} />\n                    <div className=\"StudentStats\">\n                        <img className=\"statsIcon\" alt=\"badge icon\" src=\"assets/Badge_ico.svg\" />\n                        <span className=\"statsLabel\">{student.badges.length}</span>\n                    </div>\n                </div>\n            </div>\n        </div>\n    )\n}\n\nfunction StudentCoins(props) {\n    const { student } = props;\n    const [coinsCount, setCoinsCount] = useState(student.coins);\n    const [makingChanges, setMakingChanges] = useState(false);\n    useEffect(() => {\n        setMakingChanges(false);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [student._id]);\n    useEffect(() => {\n        setCoinsCount(student.coins);\n    }, [student.coins]);\n    const handleUpdateCoins = async () => {\n        const response = await fetch(`/student/${student._id}/coins`, {\n            method: 'PUT',\n            headers: {\n                'Content-Type': 'application/json'\n            },\n            body: JSON.stringify({\n                coins: coinsCount\n            })\n        });\n        const body = await response.json();\n        if (!body) return console.log('no response from server');\n        if (!body.success) return console.log('no success=true message from server');\n        setMakingChanges(false);\n        props.refreshData();\n    }\n    const editCoinsButtons = () => {\n        return (\n            <div>\n                <button className=\"stealth link\" onClick={() => addCoins(-10)}><i className=\"fas fa-minus-circle\"></i></button>\n                <button className=\"stealth link\" onClick={() => addCoins(10)}><i className=\"fas fa-plus-circle\"></i></button>\n            </div>\n        )\n    }\n    const addCoins = (amount) => {\n        setCoinsCount(coinsCount + amount);\n    }\n    const formatCoins = (number) => number.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, \",\");\n    return (\n        <div className=\"StudentStats\">\n            <img className=\"statsIcon\" alt=\"coin icon\" src=\"assets/Coin_ico.png\" />\n            <span className=\"statsLabel\">{formatCoins(coinsCount)}</span>\n            <div className=\"editCoinsButton\">\n                {makingChanges ? editCoinsButtons() : <button className=\"stealth link\" onClick={() => setMakingChanges(true)}>Edit</button>}\n            </div>\n            {makingChanges && <div className=\"confirmChangesButton\">\n                <button className=\"secondary\" onClick={() => handleUpdateCoins(student._id)}>Save</button>\n                <button className=\"secondary greyed\" onClick={() => {\n                    setMakingChanges(false);\n                    setCoinsCount(student.coins);\n                }}>Cancel</button>\n            </div>}\n        </div>\n    )\n}\n\nfunction ViewHomework(props) {\n    const { homework } = props;\n    const viewHomework = () => {\n        if (!homework.length) return 'No homework exists for this student';\n        const homeworkModules = [];\n        for (let i = 0; i < homework.length; i++) {\n            homeworkModules.push(<Homework {...props} key={homework[i]._id} {...homework[i]} />)\n        }\n        return homeworkModules;\n    }\n    return (\n        <div className=\"ViewHomework\">\n            {viewHomework()}\n        </div>\n    )\n}\n\nfunction Homework(props) {\n    const { _id, date, headline, assignments } = props;\n    const [showingMenu, updateShowingMenu] = useState(false);\n    const toggleMenu = () => {\n        updateShowingMenu(prevState => !prevState);\n    }\n    const showMenu = () => {\n        return (\n            <ContextMenu\n              position={null}\n              updateContextMenu={() => updateShowingMenu(false)}>\n                <ul className=\"editDelete\">\n                    <li><button onClick={editHomework}>Edit</button></li>\n                    <li><button onClick={confirmDeleteHomework}>Delete</button></li>\n                </ul>\n            </ContextMenu>\n        );\n    }\n    const editHomework = () => {\n        updateShowingMenu(false);\n        props.updateModal(<EditHomeworkForm {...props} />);\n    }\n    const confirmDeleteHomework = () => {\n        updateShowingMenu(false);\n        let content = (options = {\n            loadingIcon: false\n        }) => (\n            <div className=\"modalBox\">\n                <h2>Are you sure you want to proceed?</h2>\n                This cannot be undone.\n                {options.loadingIcon\n                    ?   <Loading />\n                    :   <div className=\"buttons\">\n                            <button onClick={handleDeleteHomework}>Yes, I'm sure</button>\n                            <button className=\"greyed\" onClick={() => props.updateModal(false)}>Cancel</button>\n                        </div>\n                    }\n            </div>\n        );\n        props.updateModal(content);\n    }\n    const handleDeleteHomework = async () => {\n        const response = await fetch(`/student/homework/${_id}`, { method: 'DELETE' });\n        const body = await response.json();\n        if (!body) return console.log('no response from server');\n        if (!body.success) return console.log('no { success: true } response from server');\n        props.updateModal(false);\n        props.refreshHomework();\n    }\n    const homeworkAssignments = () => {\n        const assignmentsList = [];\n        for (let i = 0; i < assignments.length; i++) {\n            assignmentsList.push(<Assignment {...props} homeworkId={_id} key={assignments[i]._id} index={i} {...assignments[i]} />);\n        }\n        return assignmentsList;\n    }\n    return (\n        <div className=\"Homework\">\n            <div className=\"homeworkHeader\">\n                <div>\n                    <span className=\"date\">{prettifyDate(date)}</span>\n                    <h3>{headline}</h3>\n                </div>\n                <div className=\"options\">\n                    <button className=\"stealth\" onClick={toggleMenu}><i className=\"fas fa-bars\"></i></button>\n                    {showingMenu && showMenu()}\n                </div>\n            </div>\n            <div className=\"homeworkBody\">\n                <ul>\n                    <li className=\"smol\">\n                        <div className=\"label\">Assignments</div>\n                        <div className=\"progress\">Progress</div>\n                    </li>\n                </ul>\n                <ol>\n                    {homeworkAssignments()}\n                </ol>\n            </div>\n        </div>\n    )\n}\n\nfunction Assignment(props) {\n    const { student, homeworkId } = props;\n    const coinsNumber = useRef(null);\n    const addCoins = async (index, recorded = true) => {\n        if (props.recorded) return;\n        const response = await fetch(`/assignment/${homeworkId}/recorded`, {\n            method: 'PUT',\n            headers: {\n                'Content-Type': 'application/json'\n            },\n            body: JSON.stringify({\n                index,\n                recorded\n            })\n        });\n        const body = await response.json();\n        if (!body) return console.log('no response from server');\n        if (!body.success) return console.log('no { success: true } response from server');\n        const updateCoins = async () => {\n            let coinsCount = parseInt(coinsNumber.current.innerHTML);\n            coinsCount += student.coins;\n            const response = await fetch(`/student/${student._id}/coins`, {\n                method: 'PUT',\n                headers: {\n                    'Content-Type': 'application/json'\n                },\n                body: JSON.stringify({\n                    coins: coinsCount\n                })\n            });\n            const body = await response.json();\n            if (!body) return console.log('no response from server');\n            if (!body.success) return console.log('no { success: true } message from server');\n            console.log('success!!!!!');\n            props.refreshData();\n            props.refreshHomework();\n        }\n        updateCoins();\n    }\n    const updateHomeworkProgress = async (index, value) => {\n        const response = await fetch(`/student/homework/assignment/${homeworkId}/progress`, {\n            method: 'PUT',\n            headers: {\n                'Content-Type': 'application/json'\n            },\n            body: JSON.stringify({\n                index,\n                value\n            })\n        });\n        const body = await response.json();\n        if (!body) return console.log('no response from server');\n        if (!body.success) return console.log('no { success: true } response from server');\n        props.refreshHomework();\n    }\n    return (\n        <li>\n            <div className=\"label\">{props.label}</div>\n            <div className=\"progress\">\n                <input type=\"range\"\n                    min=\"0\" max=\"4\"\n                    defaultValue={props.progress.toString()}\n                    onChange={(e) => updateHomeworkProgress(props.index, e.target.value)}\n                    disabled={props.recorded ? true : false} />\n                {(props.progress > 0) &&\n                    <div className={`coinsEarned${props.recorded ? ' coinsAdded' : ''}`} onClick={() => addCoins(props.index)}>\n                        <img className=\"coinIcon\" alt=\"coin icon\" src=\"assets/Coin_ico.png\" />\n                        <span ref={coinsNumber}>{`${props.progress * 20}`}</span>\n                    </div>}\n            </div>\n        </li>\n    )\n}\n\nfunction AddHomeworkForm(props) {\n    const { student } = props;\n    const [formData, updateFormData] = useState({\n        date: dayjs().format('YYYY-MM-DD'),\n        headline: '',\n        assignments: [{}, {}, {}, {}]\n    });\n    const handleSubmit = async (e) => {\n        e.preventDefault();\n        const response = await fetch(`/student/${student._id}/homework`, {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json'\n            },\n            body: JSON.stringify(formData)\n        });\n        const body = await response.json();\n        if (!body) return console.log('no response from server');\n        if (!body.success) return console.log('no { success: true } response from server');\n        props.updateModal(false);\n        props.refreshData();\n        props.refreshHomework();\n    }\n    const handleAddAssignment = (index, label) => {\n        let { assignments } = formData;\n        let item = assignments[index];\n        item = { label: label, progress: 0 }\n        assignments[index] = item;\n        updateFormData({ ...formData, assignments });\n    }\n    const today = () => {\n        return dayjs().format('YYYY-MM-DD');\n    }\n    return (\n        <form className=\"addHomeworkForm\" onSubmit={handleSubmit} autoComplete=\"off\">\n            <div className=\"addHomework\">\n                <div className=\"addHomeworkDate\">\n                    <label htmlFor=\"date\">Date:</label>\n                    <input type=\"date\" defaultValue={today()} onChange={(e) => updateFormData({ ...formData, date: e.target.value })} />\n                </div>\n                <div className=\"addHomeworkHeadline\">\n                    <label htmlFor=\"headline\">Headline:</label>\n                    <input type=\"text\" onChange={(e) => updateFormData({ ...formData, headline: e.target.value })} />\n                </div>\n                <div className=\"addHomeworkAssignments\">\n                    <label htmlFor=\"assignments\">Assignments:</label>\n                    <li><span className=\"numBubble\">1.</span><input type=\"text\" onChange={(e) => handleAddAssignment(0, e.target.value)} /></li>\n                    <li><span className=\"numBubble\">2.</span><input type=\"text\" onChange={(e) => handleAddAssignment(1, e.target.value)} /></li>\n                    <li><span className=\"numBubble\">3.</span><input type=\"text\" onChange={(e) => handleAddAssignment(2, e.target.value)} /></li>\n                    <li><span className=\"numBubble\">4.</span><input type=\"text\" onChange={(e) => handleAddAssignment(3, e.target.value)} /></li>\n                </div>\n            </div>\n            <input type=\"Submit\" />\n        </form>\n    )\n}\n\nfunction EditHomeworkForm(props) {\n    const { _id, date, headline, assignments } = props;\n    const [formData, updateFormData] = useState({ _id, date, headline, assignments });\n    const handleEditHomework = async (e) => {\n        e.preventDefault();\n        const response = await fetch(`/student/homework/${_id}`, {\n            method: 'PUT',\n            headers: {\n                'Content-Type': 'application/json'\n            },\n            body: JSON.stringify(formData)\n        });\n        const body = await response.json();\n        if (!body) return console.log('no response from server');\n        if (!body.success) return console.log('no { success: true } response from server');\n        props.updateModal(false);\n        props.refreshHomework();\n    }\n    const handleEditAssignment = (index, label) => {\n        let item = assignments[index];\n        item.label = label;\n        assignments[index] = item;\n        updateFormData({ ...formData, assignments });\n    }\n    return (\n        <form className=\"addHomeworkForm\" onSubmit={handleEditHomework} autoComplete=\"off\">\n            <h2>Edit homework for {prettifyDate(date)}</h2>\n            <div className=\"addHomework\">\n                <div className=\"addHomeworkDate\">\n                    <label htmlFor=\"date\">Date:</label>\n                    <input type=\"date\" defaultValue={date.split('T')[0]} onChange={(e) => updateFormData({ ...formData, date: e.target.value })} />\n                </div>\n                <div className=\"addHomeworkHeadline\">\n                    <label htmlFor=\"headline\">Headline:</label>\n                    <input type=\"text\" defaultValue={headline} onChange={(e) => updateFormData({ ...formData, headline: e.target.value })} />\n                </div>\n                <div className=\"addHomeworkAssignments\">\n                    <label htmlFor=\"assignments\">Assignments:</label>\n                    <li><span className=\"numBubble\">1.</span><input type=\"text\" defaultValue={assignments[0].label} onChange={(e) => handleEditAssignment(0, e.target.value)} /></li>\n                    <li><span className=\"numBubble\">2.</span><input type=\"text\" defaultValue={assignments[1].label} onChange={(e) => handleEditAssignment(1, e.target.value)} /></li>\n                    <li><span className=\"numBubble\">3.</span><input type=\"text\" defaultValue={assignments[2].label} onChange={(e) => handleEditAssignment(2, e.target.value)} /></li>\n                    <li><span className=\"numBubble\">4.</span><input type=\"text\" defaultValue={assignments[3].label} onChange={(e) => handleEditAssignment(3, e.target.value)} /></li>\n                </div>\n            </div>\n            <input type=\"Submit\" />\n        </form>\n    )\n}","/Users/ngw/Documents/Sites/Pianopet/client/src/components/ContextMenu.js",["124"],"import { useEffect } from 'react';\nimport { elementHasParent } from '../utils';\n\nexport default function ContextMenu(props) {\n    useEffect(() => {\n        const closeContextMenu = (e) => {\n            if (props.ignoreClick) { // will be an array like ['.Modal', '#menu li']\n                for (let selector of props.ignoreClick) {\n                    if (elementHasParent(e.target, selector)) return;\n                }\n            }\n            props.updateContextMenu(false);\n        }\n        window.addEventListener('click', closeContextMenu);\n        return () => window.removeEventListener('click', closeContextMenu);\n    }, []);\n    return (\n        <div className=\"ContextMenu\" style={props.position}>\n            {props.children}\n        </div>\n    );\n}","/Users/ngw/Documents/Sites/Pianopet/client/src/components/Dropdown.js",["125","126"],"import { useEffect, useRef, useState } from 'react';\nimport { elementHasParent } from '../utils';\n\nexport default function Dropdown(props) {\n    const { defaultValue, listItems, restoreDefault } = props;\n    const [display, setDisplay] = useState(() => {\n        if (!listItems || !listItems.length) return 'Add new...';\n        if (!defaultValue) return 'Select one';\n        return defaultValue.display;\n    });\n    const [isOpen, setIsOpen] = useState(false);\n    const [addingNew, setAddingNew] = useState(false);\n    const dropdownList = useRef(null);\n    useEffect(() => {\n        const closeDropdown = (e) => {\n            if (elementHasParent(e.target, '.dropdownDisplay')) return;\n            if (elementHasParent(e.target, '.addNew')) return;\n            setIsOpen(false);\n        }\n        window.addEventListener('click', closeDropdown);\n        return () => window.removeEventListener('click', closeDropdown);\n    }, []);\n    useEffect(() => {\n        if (!dropdownList || !dropdownList.current) return;\n        if (isOpen) dropdownList.current.style.maxHeight = dropdownList.current.scrollHeight + 1 + 'px'; // plus 1px to account for 1px bottom border\n        else {\n            dropdownList.current.style.maxHeight = '0px';\n            setAddingNew(false); // unrelated to maxHeight adjustment thing\n        }\n    }, [isOpen]);\n    useEffect(() => {\n        if (addingNew) dropdownList.current.style.maxHeight = dropdownList.current.scrollHeight + 1 + 'px';\n    }, [addingNew]);\n    useEffect(() => {\n        if (restoreDefault) setDisplay(defaultValue.display);\n    }, [restoreDefault]);\n    const toggleIsOpen = () => setIsOpen(prevState => !prevState);\n    const handleClick = (e) => {\n        setDisplay(e.target.innerHTML);\n        props.onChange(e.target.getAttribute('data-value'));\n    }\n    const generateList = () => {\n        const buttonForAddNew =\n            <AddNew {...props}\n                key=\"dropdownItem-addNew\"\n                addingNew={addingNew}\n                updateAddingNew={setAddingNew}\n                updateIsOpen={setIsOpen}\n                updateDisplay={setDisplay}\n            />;\n        if ((!listItems || !listItems.length) && props.addNew) {\n            console.table(listItems);\n            return buttonForAddNew;\n        }\n        const array = [];\n        for (let item of listItems) {\n            array.push(\n                <li className=\"dropdownItem\" key={`dropdownItem-${item.value}`}>\n                    <button type=\"button\" data-value={item.value} onClick={handleClick}>{item.display}</button>\n                </li>\n            );\n        }\n        if (props.addNew) array.push(buttonForAddNew);\n        return array;\n    }\n    return (\n        <div className={`Dropdown${isOpen ? ' expanded' : ''}`} style={props.style}>\n            <div className=\"dropdownDisplay\" onClick={toggleIsOpen}>{display}</div>\n            <ul className=\"dropdownList\" ref={dropdownList}>{generateList()}</ul>\n        </div>\n    );\n}\n\nfunction AddNew(props) {\n    const { addingNew } = props;\n    const [inputValue, setInputValue] = useState(null);\n    const inputRef = useRef(null);\n    useEffect(() => {\n        if (!addingNew) return setInputValue(null);\n        inputRef.current.focus();\n        const handleKeydown = (e) => {\n            if (e.key === 'Escape') return props.updateAddingNew(false);\n            if (e.key === 'Enter') {\n                e.preventDefault();\n                props.addNew(inputRef.current.value);\n                props.updateDisplay(inputRef.current.value);\n                props.onChange(inputRef.current.value);\n                props.updateIsOpen(false);\n                return;\n            }\n        }\n        window.addEventListener('keydown', handleKeydown);\n        return () => window.removeEventListener('keydown', handleKeydown);\n    }, [addingNew]);\n    return (\n        <li className=\"dropdownItem\">\n            {addingNew\n                ?   <button type=\"button\" className=\"addNew active\">\n                        <input\n                            ref={inputRef}\n                            type=\"text\"\n                            defaultValue={inputValue}\n                            onChange={(e) => setInputValue(e.target.value)}\n                        />\n                        <span className=\"inputHint\">Press Enter to submit, Esc to cancel.</span>\n                    </button>\n                :   <button type=\"button\" className=\"addNew\" onClick={() => props.updateAddingNew(true)}>\n                        {props.buttonContent || 'Add new...'}\n                    </button>\n                }\n        </li>\n    )\n}","/Users/ngw/Documents/Sites/Pianopet/client/src/components/Avatar.js",["127"],"import { useState, useEffect } from 'react';\nimport Loading from './Loading';\nimport PianopetBase from './PianopetBase';\n\nexport default function Avatar(props) {\n    const { viewingAsTeacher, avatar } = props;\n    const [color, setColor] = useState(null);\n    useEffect(() => {\n        if (!avatar) return;\n        setColor(avatar.Color?.src);\n    }, [avatar]);\n    const handleClick = () => {\n        if (!viewingAsTeacher) props.updateView('closet');\n    }\n    const generateAvatar = () => {\n        if (avatar === null) return <Loading />;\n        return Object.keys(avatar).map(key => {\n            if (key === 'Color') return;\n            const { _id, src, image } = avatar[key];\n            const style = {\n                top: `${image.y}%`,\n                left: `${image.x}%`,\n                width: `${image.w}%`\n            }\n            return (\n                <img\n                    key={`studentAvatar-${key}-${_id}`}\n                    className={`${key} avatarItem`}\n                    alt={src}\n                    src={src}\n                    style={style} />\n            );\n        });\n    }\n    return (\n        <div className=\"Avatar\">\n            <div className=\"avatarBox\" onClick={handleClick}>\n                <PianopetBase color={color} />\n                {generateAvatar()}\n            </div>\n        </div>\n    );\n}","/Users/ngw/Documents/Sites/Pianopet/client/src/components/Closet.js",["128","129"],"import { useState } from 'react';\nimport Splat from './Splat';\n\nexport default function Closet(props) {\n    const { closet, avatar, teacher } = props;\n    const [category, setCategory] = useState(() => {\n        return teacher.wearableCategories.find(category => closet.some(wearable => wearable.category === category));\n    });\n    const generate = {\n        categoriesList: (closet) => {\n            return teacher.wearableCategories.map(category => {\n                const someClosetItemHasCategory = closet.some(wearable => wearable.category === category);\n                if (someClosetItemHasCategory) return (\n                    <button\n                      key={`closet-wearableCategories-${category}`}\n                      onClick={() => setCategory(category)}>\n                          {category}\n                    </button>\n                )\n            });\n        },\n        wearablesList: (category) => {\n            const previewWearable = ({ category, _id, name, src, image }) => {\n                if (!image) { // if this is a color, not a clothing item\n                    props.updateAvatar(prevState => ({\n                        ...prevState,\n                        Color: { _id, name, src }\n                    }));\n                    return;\n                }\n                props.updateAvatar(prevState => {\n                    if (prevState[category] && prevState[category]._id === _id) {\n                        let prevStateMinusThisCategory = {...prevState};\n                        delete prevStateMinusThisCategory[category];\n                        return prevStateMinusThisCategory;\n                    }\n                    return ({\n                        ...prevState,\n                        [category]: { _id, name, src, image }\n                    });\n                });\n            }\n            const list = closet.map(wearable => {\n                const currentlyPreviewing = avatar[wearable.category] && avatar[wearable.category]._id === wearable._id;\n                if (wearable.category === category) return (\n                    <button\n                      key={`closetItem-${category}-${wearable._id}`}\n                      className={currentlyPreviewing ? 'active' : ''} // if currently previewing, add light green background or something\n                      onClick={() => previewWearable(wearable)}>\n                        {category === 'Color'\n                            ? <Splat color={wearable.src} />\n                            : <img alt={wearable.name} src={wearable.src} />}\n                        <span>{wearable.name}</span>\n                    </button>\n                );\n            });\n            const hasDefaultColor = !avatar['Color'] || avatar['Color'].src === '#5C76AE';\n            if (category === 'Color') list.splice(0, 0, (\n                <button\n                    key={`closetItem-${category}-defaultColor`}\n                    className={hasDefaultColor ? 'active' : ''}\n                    onClick={() => previewWearable({ category: 'Color', src: '#5C76AE' })}>\n                    <Splat color=\"#5C76AE\" />\n                    <span>Default</span>\n                </button>\n            ));\n            return list;\n        }\n    }\n    return (\n        <div className=\"Closet\">\n            <div id=\"demo\" onClick={() => console.dir(avatar)}></div>\n            <div className=\"wearableCategories\">\n                {generate.categoriesList(closet)}\n            </div>\n            <div className=\"wearablesList\">\n                <div className={category === 'Color' ? 'blobs' : null}>\n                    {generate.wearablesList(category)}\n                </div>\n            </div>\n        </div>\n    );\n}","/Users/ngw/Documents/Sites/Pianopet/client/src/components/Button.js",[],"/Users/ngw/Documents/Sites/Pianopet/client/src/components/MyAccount.js",[],"/Users/ngw/Documents/Sites/Pianopet/client/src/components/PianopetBase.js",[],["130","131"],"/Users/ngw/Documents/Sites/Pianopet/client/src/utils/ntc.js",[],"/Users/ngw/Documents/Sites/Pianopet/client/src/components/Splat.js",[],{"ruleId":"132","replacedBy":"133"},{"ruleId":"134","replacedBy":"135"},{"ruleId":"132","replacedBy":"136"},{"ruleId":"134","replacedBy":"137"},{"ruleId":"138","severity":1,"message":"139","line":5,"column":19,"nodeType":"140","messageId":"141","endLine":5,"endColumn":31},{"ruleId":"132","replacedBy":"142"},{"ruleId":"134","replacedBy":"143"},{"ruleId":"144","severity":1,"message":"145","line":24,"column":8,"nodeType":"146","endLine":24,"endColumn":30,"suggestions":"147"},{"ruleId":"144","severity":1,"message":"148","line":119,"column":8,"nodeType":"146","endLine":119,"endColumn":10,"suggestions":"149"},{"ruleId":"150","severity":1,"message":"151","line":270,"column":33,"nodeType":"152","messageId":"153","endLine":270,"endColumn":35},{"ruleId":"144","severity":1,"message":"154","line":39,"column":8,"nodeType":"146","endLine":39,"endColumn":21,"suggestions":"155"},{"ruleId":"144","severity":1,"message":"156","line":164,"column":8,"nodeType":"146","endLine":164,"endColumn":17,"suggestions":"157"},{"ruleId":"158","severity":1,"message":"159","line":242,"column":25,"nodeType":"160","endLine":247,"endColumn":27},{"ruleId":"144","severity":1,"message":"161","line":569,"column":8,"nodeType":"146","endLine":569,"endColumn":10,"suggestions":"162"},{"ruleId":"144","severity":1,"message":"163","line":601,"column":8,"nodeType":"146","endLine":601,"endColumn":21,"suggestions":"164"},{"ruleId":"144","severity":1,"message":"165","line":33,"column":8,"nodeType":"146","endLine":33,"endColumn":21,"suggestions":"166"},{"ruleId":"144","severity":1,"message":"167","line":16,"column":8,"nodeType":"146","endLine":16,"endColumn":10,"suggestions":"168"},{"ruleId":"144","severity":1,"message":"169","line":36,"column":8,"nodeType":"146","endLine":36,"endColumn":24,"suggestions":"170"},{"ruleId":"144","severity":1,"message":"167","line":94,"column":8,"nodeType":"146","endLine":94,"endColumn":19,"suggestions":"171"},{"ruleId":"150","severity":1,"message":"172","line":18,"column":34,"nodeType":"173","messageId":"174","endLine":18,"endColumn":41},{"ruleId":"150","severity":1,"message":"151","line":11,"column":60,"nodeType":"152","messageId":"153","endLine":11,"endColumn":62},{"ruleId":"150","severity":1,"message":"151","line":43,"column":46,"nodeType":"152","messageId":"153","endLine":43,"endColumn":48},{"ruleId":"132","replacedBy":"175"},{"ruleId":"134","replacedBy":"176"},"no-native-reassign",["177"],"no-negated-in-lhs",["178"],["177"],["178"],"no-new-object","The object literal notation {} is preferrable.","NewExpression","preferLiteral",["177"],["178"],"react-hooks/exhaustive-deps","React Hook useEffect has a missing dependency: 'wearables'. Either include it or remove the dependency array.","ArrayExpression",["179"],"React Hook useEffect has a missing dependency: 'getHomework'. Either include it or remove the dependency array.",["180"],"array-callback-return","Array.prototype.map() expects a value to be returned at the end of arrow function.","ArrowFunctionExpression","expectedAtEnd","React Hook useEffect has a missing dependency: 'getTeacherData'. Either include it or remove the dependency array.",["181"],"React Hook useEffect has missing dependencies: 'addNewWearable' and 'wearableModal'. Either include them or remove the dependency array.",["182"],"jsx-a11y/alt-text","img elements must have an alt prop, either with meaningful text, or an empty string for decorative images.","JSXOpeningElement","React Hook useEffect has missing dependencies: 'image.x' and 'image.y'. Either include them or remove the dependency array.",["183"],"React Hook useEffect has missing dependencies: 'elementPosition.x', 'elementPosition.y', and 'props'. Either include them or remove the dependency array. However, 'props' will change when *any* prop changes, so the preferred fix is to destructure the 'props' object outside of the useEffect call and refer to those specific props inside useEffect.",["184"],"React Hook useEffect has missing dependencies: 'getHomework', 'student.avatar', and 'wearables'. Either include them or remove the dependency array.",["185"],"React Hook useEffect has a missing dependency: 'props'. Either include it or remove the dependency array. However, 'props' will change when *any* prop changes, so the preferred fix is to destructure the 'props' object outside of the useEffect call and refer to those specific props inside useEffect.",["186"],"React Hook useEffect has a missing dependency: 'defaultValue.display'. Either include it or remove the dependency array.",["187"],["188"],"Array.prototype.map() expects a return value from arrow function.","ReturnStatement","expectedReturnValue",["177"],["178"],"no-global-assign","no-unsafe-negation",{"desc":"189","fix":"190"},{"desc":"191","fix":"192"},{"desc":"193","fix":"194"},{"desc":"195","fix":"196"},{"desc":"197","fix":"198"},{"desc":"199","fix":"200"},{"desc":"201","fix":"202"},{"desc":"203","fix":"204"},{"desc":"205","fix":"206"},{"desc":"207","fix":"208"},"Update the dependencies array to be: [student.avatar, view, wearables]",{"range":"209","text":"210"},"Update the dependencies array to be: [getHomework]",{"range":"211","text":"212"},"Update the dependencies array to be: [getTeacherData, teacher._id]",{"range":"213","text":"214"},"Update the dependencies array to be: [addNewWearable, teacher, wearableModal]",{"range":"215","text":"216"},"Update the dependencies array to be: [image.x, image.y]",{"range":"217","text":"218"},"Update the dependencies array to be: [elementPosition.x, elementPosition.y, mouseIsDown, props]",{"range":"219","text":"220"},"Update the dependencies array to be: [getHomework, student._id, student.avatar, wearables]",{"range":"221","text":"222"},"Update the dependencies array to be: [props]",{"range":"223","text":"224"},"Update the dependencies array to be: [defaultValue.display, restoreDefault]",{"range":"225","text":"226"},"Update the dependencies array to be: [addingNew, props]",{"range":"227","text":"228"},[1097,1119],"[student.avatar, view, wearables]",[5374,5376],"[getHomework]",[1597,1610],"[getTeacherData, teacher._id]",[6311,6320],"[addNewWearable, teacher, wearableModal]",[25411,25413],"[image.x, image.y]",[26695,26708],"[elementPosition.x, elementPosition.y, mouseIsDown, props]",[1480,1493],"[getHomework, student._id, student.avatar, wearables]",[632,634],"[props]",[1586,1602],"[defaultValue.display, restoreDefault]",[3829,3840],"[addingNew, props]"]